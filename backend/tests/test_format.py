from app.agents.utils import parse_llm_output, save_meta, save_episode_summary

def test_llm아웃풋을_xml로_변환한다():
    xml_str = """
    <story>
    <title>세상에서 가장 완벽한 오해</title>
<characters>
    <p><b>김서준 (남주)</b>: 완벽주의자로 소문난 성공한 크리에이티브 에이전시의 CEO. 겉으로는 늘 여유롭고 재치 있는 유머와 능숙한 말솜씨로 사람들을 대하지만, 사실은 누구보다 치열하게 노력하고 속 깊은 진심을 감추고 있다. 칭찬을 받으면 농담으로 넘기기 일쑤이며, 좀처럼 자신의 내면을 드러내지 않는다. 조용히 타인을 배려하고 챙기는 따뜻한 마음을 가졌다. 이마부터 허리까지 완벽한 피지컬을 자랑하지만, 본인은 무심하다.</p>
    <p><b>한예진 (여주)</b>: 강단 있고 예리한 통찰력을 지닌 이벤트 플래너. 겉모습보다는 진정성을 중요하게 여기며, 불의를 참지 못하는 성격이다. 처음에는 서준의 완벽함과 유머러스한 태도를 가식으로 오해하지만, 함께 일하며 그의 진정한 노고와 따뜻한 마음을 알아가게 된다. 시니컬해 보이지만 누구보다 따뜻하고 정의롭다.</p>
    <p><b>이준호</b>: 서준의 크리에이티브 디렉터. 늘 긍정적이고 팀원들을 열정적으로 격려하는 분위기 메이커. 서준의 가장 든든한 조력자이자 친구다.</p>
    <p><b>민경우</b>: 서준의 에이전시 소속 사운드 엔지니어이자 프로듀서. 말이 많지 않지만, 핵심을 꿰뚫는 통찰력과 현실적인 조언으로 서준에게 큰 도움을 준다. 겉은 무심해 보이지만 누구보다 서준의 진심을 잘 이해하고 있다.</p>
    <p><b>정은호</b>: 서준의 에이전시 PR/마케팅 총괄. 팀에 대한 자부심이 강하고, 어떤 기획이든 열린 마음으로 지지하며 팀원들을 전폭적으로 응원한다. 특유의 활기찬 미소와 긍정적인 에너지로 모두를 이끈다.</p>
    <p><b>박현준</b>: 서준의 에이전시 HR 팀장이자 팀원들의 정신적 지주. 타인의 감정을 섬세하게 헤아리고, 어려움을 겪는 동료에게 가장 먼저 다가가 위로와 조언을 건넨다. 따뜻한 포용력으로 팀원들을 아우른다.</p>
    <p><b>김태우</b>: 서준의 에이전시 소속 포토그래퍼 겸 디자이너. 조용하고 순수한 영혼의 소유자로, 타인을 비난하거나 깎아내리지 않는다. 힘들어하는 동료가 있으면 묵묵히 곁을 지키며 위로를 건네는 따뜻한 마음을 가졌다.</p>
    <p><b>전원우</b>: 서준의 에이전시 디지털 콘텐츠 크리에이터. 트렌드에 민감하고 유머 감각이 뛰어나며, 젊은 세대의 감성을 대표하는 '밈' 덕후다. 통통 튀는 매력으로 팀에 활력을 불어넣는다.</p>
</characters>
<summary>
완벽주의자로 소문난 크리에이티브 에이전시의 CEO 김서준. 그는 타고난 재능과 노력으로 모든 일을 완벽하게 해내지만, 늘 능글맞은 유머와 침착한 태도 뒤에 진심을 숨긴다. 이런 그를 가식적이라 오해하는 열정적인 이벤트 플래너 한예진은 서준의 프로젝트에 합류하게 되고, 두 사람은 사사건건 부딪힌다. 하지만 예진은 서준의 완벽함 뒤에 숨겨진 치열한 노력과 따뜻한 인간적인 면모를 조금씩 발견하게 되고, 서준 또한 자신을 있는 그대로 봐주는 예진에게 점차 마음을 열기 시작한다. 오해로 시작된 두 사람의 관계는 수많은 위기와 갈등을 거치며 진정한 사랑으로 발전하고, 마침내 서준은 완벽함이라는 가면을 벗고 세상에 자신의 진심을 드러낸다.
</summary>
<plots>
    <episode>
        <episode_number>1</episode_number>
        <summary>
            열정 넘치는 이벤트 플래너 한예진은 완벽주의자로 소문난 CEO 김서준의 프로젝트에 합류하게 된다. 첫 대면에서 서준은 능글맞은 유머와 빈틈없는 태도로 예진을 맞이하고, 예진은 그의 완벽함이 오히려 가식적으로 느껴져 경계심을 품는다. 프로젝트의 첫 난관에서 서준은 예상치 못한 기지로 상황을 해결하지만, 예진은 여전히 그가 보여주는 모습이 전부가 아닐 것이라는 의심을 거두지 못한다. 예진은 서준의 '완벽함'이라는 가면 뒤에 무엇이 숨어있는지 파헤치기로 결심하며, 두 사람의 팽팽한 신경전이 시작된다.
        </summary>
    </episode>
    <episode>
        <episode_number>2</episode_number>
        <summary>
            프로젝트의 방향을 두고 예진과 서준 사이에 첫 번째 의견 충돌이 발생한다. 예진은 실용적이고 현실적인 접근을 주장하는 반면, 서준은 대담하고 혁신적인 아이디어를 고수하며 팽팽하게 맞선다. 서준은 특유의 침착함과 논리로 예진을 압도하는 듯 보이지만, 예진 또한 날카로운 통찰력으로 반박하며 그를 당황시킨다. 서로의 방식에 대한 이해 없이 평행선을 달리던 두 사람은 결국 타협점을 찾지 못하고, 첫 협업은 미묘한 긴장감 속에 마무리된다.
        </summary>
    </episode>
    <episode>
        <episode_number>3</episode_number>
        <summary>
            예진은 서준의 완벽한 결과물 뒤에 숨겨진 노력을 우연히 목격하게 된다. 야근을 하던 예진은 아무도 없는 사무실에서 홀로 남겨진 서준이 밤늦게까지 자료를 분석하고 아이디어를 구상하는 모습을 발견한다. 늘 여유롭고 완벽해 보이던 그의 모습 뒤에 상상 이상의 노력과 치열함이 있다는 것을 깨달은 예진은 그에 대한 오해를 조금씩 풀기 시작한다. 예진은 서준이 단순한 천재가 아니라, 누구보다 성실하게 노력하는 사람임을 어렴풋이 느끼며 그에게 새로운 시선을 두게 된다.
        </summary>
    </episode>
    <episode>
        <episode_number>4</episode_number>
        <summary>
            프로젝트에 예상치 못한 문제가 발생하고, 서준은 침착하게 팀원들을 독려하며 위기를 헤쳐나간다. 서준은 팀원인 준호와 은호를 믿고 전폭적으로 지지하며, 그들의 잠재력을 끌어내는 리더십을 발휘한다. 예진은 서준이 겉으로 드러나는 완벽함뿐만 아니라, 팀원들을 향한 진심 어린 격려와 굳건한 신뢰를 바탕으로 팀을 이끌어가는 모습에 깊은 인상을 받는다. 서준의 뛰어난 리더십과 팀원들의 단단한 팀워크 덕분에 위기가 극복되고, 예진은 서준에 대한 존경심을 갖게 된다.
        </summary>
    </episode>
    <episode>
        <episode_number>5</episode_number>
        <summary>
            중요한 발표를 앞두고 서준에게 예상치 못한 개인적인 어려움이 닥쳐온다. 늘 완벽하게 자신을 통제하던 서준이 드물게 당황하거나 미묘한 불안감을 드러내는 모습을 예진이 목격하게 된다. 예진은 그에게 도움을 주려 다가가고, 서준은 평소와 달리 자신의 약점을 조금이나마 내보이며 예진에게 인간적인 면모를 드러낸다. 서준의 완벽함 뒤에 감춰진 인간적인 고뇌와 약점을 보게 된 예진은 그에게 연민과 함께 미묘한 끌림을 느끼기 시작한다.
        </summary>
    </episode>
    <episode>
        <episode_number>6</episode_number>
        <summary>
            두 사람은 프로젝트 외적인 사적인 대화를 나누며 서로에 대한 이해를 깊게 한다. 서준은 특유의 재치 있는 농담과 말장난으로 분위기를 유쾌하게 이끌지만, 그 농담 속에 섬세한 배려와 깊은 통찰이 담겨 있음을 예진이 알아차린다. 예진은 서준의 유머가 단순히 가벼운 것이 아니라, 자신을 보호하고 타인을 편안하게 해주려는 그의 진심 어린 방식임을 깨닫고 놀라움을 금치 못한다. 유머러스한 가면 뒤에 숨겨진 서준의 진솔한 마음을 발견한 예진은 그에게 서서히 마음을 열기 시작한다.
        </summary>
    </episode>
    <episode>
        <episode_number>7</episode_number>
        <summary>
            프로젝트에 새로운 외부 인물이 합류하고, 그가 서준에게 과도한 관심을 보이자 예진은 알 수 없는 감정에 휩싸인다. 외적인 매력과 능력을 겸비한 경쟁자가 서준에게 적극적으로 다가서는 모습을 보며, 예진은 무의식중에 불편함과 미묘한 질투심을 느낀다. 예진은 자신의 감정이 단순한 동료애를 넘어선 것임을 깨닫고 혼란스러워하며, 서준을 향한 마음이 깊어지고 있음을 자각한다. 서준은 그런 예진의 미묘한 변화를 눈치채고 그녀에게 더욱 신경 쓰기 시작하며, 두 사람의 관계는 새로운 국면을 맞이한다.
        </summary>
    </episode>
    <episode>
        <episode_number>8</episode_number>
        <summary>
            서준의 과거와 관련된 루머가 돌기 시작하고, 이는 프로젝트에도 악영향을 미칠 위기에 처한다. 예진은 서준의 동료 경우로부터 서준이 과거에 겪었던 아픔과 그로 인해 그가 얼마나 자신을 드러내지 않게 되었는지 듣게 된다. 서준이 완벽함이라는 가면을 쓰게 된 배경을 이해하게 된 예진은 그에 대한 연민과 함께, 그를 지켜주고 싶다는 강한 충동을 느낀다. 예진은 서준의 과거를 파헤치는 대신, 그의 현재를 지지하고 믿어주기로 결심하며 그에게 든든한 버팀목이 되어주려 한다.
        </summary>
    </episode>
    <episode>
        <episode_number>9</episode_number>
        <summary>
            프로젝트의 핵심 데이터가 유출되는 치명적인 위기가 발생하고, 모든 의심이 서준에게 향한다. 서준은 침착하게 상황을 수습하려 하지만, 외부의 압박과 오해 속에서 깊은 고독감을 느낀다. 예진은 서준을 향한 흔들림 없는 믿음을 보여주며 그의 곁을 지키고, 함께 진범을 찾아 나선다. 원우의 도움으로 단서를 찾는다. 위기 속에서 서로에게 깊이 의지하게 된 두 사람은 비로소 감정의 벽을 허물고, 서로의 존재가 얼마나 소중한지 깨닫는다.
        </summary>
    </episode>
    <episode>
        <episode_number>10</episode_number>
        <summary>
            예진과 서준은 유출 사건의 진범을 밝혀내고, 서준의 누명은 벗겨진다. 예진의 날카로운 추리와 서준의 침착한 대응, 그리고 동료들의 도움으로 사건의 전말이 밝혀지면서 모두가 안도한다. 서준은 자신을 끝까지 믿어준 예진에게 진심으로 고마움을 표현하고, 그의 눈빛에서 깊은 감사의 마음과 함께 복잡한 감정이 스쳐 지나간다. 위기를 함께 극복하며 두 사람의 관계는 단순한 동료를 넘어선 깊은 신뢰와 애정으로 발전하고, 서준은 예진에게 특별한 마음을 품게 된다.
        </summary>
    </episode>
    <episode>
        <episode_number>11</episode_number>
        <summary>
            프로젝트가 성공적으로 마무리되고, 서준은 예진에게 자신의 진심을 고백할 기회를 찾는다. 서준은 예진에게 진심을 담은 메시지를 전하려 하지만, 평소의 능글맞음과는 달리 긴장하고 망설이는 모습을 보인다. 예진은 서준의 진심 어린 고백에 놀라면서도, 그동안 자신도 모르게 키워왔던 감정들을 마주하게 된다. 서준의 용기 있는 고백에 예진은 복잡한 마음으로 답을 유보하지만, 두 사람 사이의 새로운 관계가 시작될 것임을 예고한다.
        </summary>
    </episode>
    <episode>
        <episode_number>12</episode_number>
        <summary>
            서준의 고백 이후, 두 사람은 어색하지만 설레는 첫 데이트를 하게 된다. 완벽했던 서준은 데이트에서 의외의 허당미를 보이기도 하고, 예진은 그런 그의 새로운 모습에 웃음을 터뜨리며 더욱 편안함을 느낀다. 서로의 일상 속으로 자연스럽게 스며들며, 두 사람은 연인으로서의 관계를 조심스럽게 탐색하고 서로에 대한 설렘을 키워나간다. 데이트를 통해 서로의 진심을 확인한 두 사람은 이제 연인으로서의 첫걸음을 내딛으며, 미래에 대한 기대감을 품게 된다.
        </summary>
    </episode>
    <episode>
        <episode_number>13</episode_number>
        <summary>
            서준과 예진의 관계가 외부로 알려지기 시작하면서 대중의 관심과 오해가 쏟아진다. 서준은 자신의 완벽한 이미지가 깨질까 우려하기보다, 예진이 받을 상처를 걱정하며 그녀를 보호하려 애쓴다. 악의적인 소문과 오해 속에서도 두 사람은 서로에 대한 믿음을 잃지 않고, 오히려 더욱 단단하게 뭉쳐 자신들의 사랑을 지키려 노력한다. 태우와 현준이 이들을 지지한다. 외부의 시선과 압박 속에서 두 사람의 사랑은 더욱 깊어지고, 서로가 서로에게 가장 든든한 존재임을 확인한다.
        </summary>
    </episode>
    <episode>
        <episode_number>14</episode_number>
        <summary>
            서준은 예진과의 관계를 공식적으로 인정하며, 대중 앞에서 자신의 진심을 밝히기로 결심한다. 그는 자신의 유머와 진솔함을 담아 예진에 대한 깊은 애정과 그동안 숨겨왔던 진정한 자신을 드러내는 감동적인 메시지를 전한다. 대중은 그의 진심에 감동하고, 예진은 서준이 자신에게 보여준 용기와 사랑에 벅찬 감동을 느낀다. 서준은 예진을 통해 비로소 완벽한 가면 뒤에 숨겨진 진정한 자신을 세상에 드러내고, 두 사람의 사랑은 모든 오해를 넘어 진정한 완벽함으로 완성된다.
        </summary>
    </episode>
    <episode>
        <episode_number>15</episode_number>
        <summary>
            모든 오해와 시련을 극복한 서준과 예진은 서로의 가장 소중한 존재가 되어 행복한 나날을 보낸다. 두 사람은 각자의 분야에서 더욱 성장하며 서로에게 영감을 주고, 일과 사랑 모두에서 성공적인 모습을 보여준다. 예진은 서준의 유머와 따뜻함에 여전히 설레고, 서준은 예진의 열정과 진심에 늘 감사하며 서로를 아끼고 존중한다. 완벽한 오해로 시작된 그들의 이야기는 이제 세상에서 가장 아름답고 완벽한 사랑 이야기로 기억되며, 두 사람의 행복한 미래를 암시하며 막을 내린다.
        </summary>
    </episode>
</plots>
</story>
    """
    title, characters, summary, episodes = parse_llm_output(xml_str)
    

    save_meta(title, characters, summary, "/home/silver/workspace/FanTale/samples/romance_bts_1/meta_sample.xml")

    for episode in episodes:
        save_episode_summary(episode, "/home/silver/workspace/FanTale/samples/romance_bts_1/episode_summaries")

