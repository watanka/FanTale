# Project Name: FanTale
- FanTale is a Fanfiction platform that allows users to read their idols related stories.
- FanTale analyze user's preference and provide personalized stories.
- Stories are generated by LLM, and divided into chapters. Users receive stories chapter by chapter every day. With premium subscription, users can read more chapters per day. Detailed subscription plan will be determined after assessing market response to the MVP.
- Plotting Stories according to users' preference is the key feature of FanTale. Stories generated by LLM agent should be interesting and engaging to users.

# User Scenario(Story)
- User can register via google.
- User can login via google.
- User can logout.
- Right After first login, users select their preference in story-generation setting page. Options include idols, genres, etc.
- After users' first login, chapters(parts) of llm-generated story will be restored in the app. User can also give feedback to the story.
- Story consists of about 10 - 15 chapters. The number of chapters released per day is set to 3 to keep users interested, but it can be changed after market response.
- After story is completed, user receive another preference survey that will be used for another story generation.
- If user likes the story, user can share it on the page - so called Fandom Page. This page will be only opened to premium users. Shared stories can be sorted by idols, genres, etc. Users can leave comments on the stories. 

# User Preference Detail
- idols: k-pop idols (limited range for now. Subject can be expanded; such as animation character, movie character, etc, but not at the moment. select only one idol)
- genres: 로맨스, 느와르, 리얼물(실제 아이돌 캐릭터가 등장), 판타지, 학원물, 캠퍼스물, BL, GL



# UI
Login/Signup Page
Story Setting Page
Story Page
Story Chapter Page
Fandom Page
User Profile Page


# Tech Stack
- Backend: Python, FastAPI, Langchain, Neo4J, Celery, Redis
- Frontend: support Web, Iphone, Android

# API endpoints
- /auth/login, `POST`
- /auth/logout, `POST`
- /stories, `POST`, 스토리 생성
    [Request Body]
    - StoryCreationRequest
        - user_id: int
        - story_parameter: StoryParameter

    - StoryParameter
        - num_chapters: int
        - idols: str
        - genre: str # 백엔드에서는 enum
    
    [Response Body]
    - StoryCreateResponse
        - story_id: int
        - status: str
    
- /stories/{story_id}/status `GET`, 비동기 상태 확인. 스토리 생성 상태 조회
    [Response Body]
    - StoryStatusResponse
        - status: str

- /users/stories `GET`, 사용자의 스토리 목록 조회
    [Request Body]
    - StoryListRequest
        - user_id: int
    
    [Response Body]
    - StoryListResponse
        - stories: List[Story]


- /stories/{story_id}, `GET`, 스토리 조회
    [Request Body]
    - StoryRetrieveRequest
        - story_id: int
    
    [Response Body]
    - StoryRetrieveResponse
        - story_id: int
        - title: str
        - chapters: List[Chapter]

    - Chapter
        - chapter_id: int
        - chapter_number: int
        - summary: str
        - content: str

- /stories/{story_id}/chapter/{chapter_id}, `GET`, 스토리 챕터 조회
    [Request Body]
    - ChapterRetrieveRequest
        - chapter_id: int

    [Response Body]
    - StoryChapterRetrieveResponse
        - chapter: Chapter

- /stories/{story_id}/chapter/{chapter_id}/feedback, `POST`, 스토리 챕터 피드백
    [Request Body]
    - ChapterFeedbackRequest
        - chapter_id: int
        - feedback_text: str
        - like: bool


    [Response Body]
    - ChapterFeedbackResponse
        - chapter_id: int
        - feedback: str

- /stories/{story_id}/share, `POST`, 스토리 공유
    [Response Body]
    - StoryShareResponse
        - story_id: int

- /fandoms, `GET`, 팬덤 조회
    [Response Body]
    - FandomListResponse
        - fandoms: List[Story]


# LLM Agent Architecture
- user story generation은 `/users/story` endpoint 호출 시, celery에 큐로 생성.
- batch 작업으로 llm api 호출.
- Agent 구성은 
    - Plot Agent(Tool Calling; web search on idols)
    - Chapter Agent
        - retrieve plot, previous chapter, current chapter from memory
        - cliche(뻔해) agent: 생성된 챕터 중 너무 뻔한 부분을 찾아서 수정. 수정 후, plot이 바뀌었을 경우 메모리에 업데이트 필요.
        - more detail scene agent: 생성된 챕터로부터 유저들이 더 원하는 장면에 대한 디테일한 묘사 추가
        - novelist agent: 소설가로써 생성된 챕터에 대한 피드백 부여


# Directory Architecture
```
backend/
    src/
        api/                # FastAPI 라우터
            routes/         # 엔드포인트별 라우터 (users.py, story.py 등)
            dependencies/   # API 의존성 주입 (auth, pagination 등)
        core/               # 핵심 설정 & 초기화
            config.py       # 환경변수, 설정
            celery_app.py   # Celery 초기화
            logger.py
            neo4j_client.py # Neo4j 연결
            redis_client.py # Redis 연결
        db/                 
            models/         # ORM 모델 or Neo4j 쿼리 정의
            repositories/   # DB CRUD 로직
        agents/             # LLM 관련 모듈
            __init__.py
            plot_agent.py
            chapter_agent.py
            cliché_agent.py
            detail_agent.py
            novelist_agent.py
            pipelines/      # 여러 agent를 연결한 스토리 생성 파이프라인
        schemas/            # Pydantic Request/Response 스키마
        services/           # 비즈니스 로직 계층
            story_service.py
            user_service.py
        tasks/              # Celery 작업 정의
            story_tasks.py
        utils/              # 공통 유틸
            time_utils.py
            text_utils.py
    tests/
        api/
        agents/
        services/
        tasks/
frontend/
    src/
        api/                # axios 호출 모듈
        components/         # UI 컴포넌트
            common/         # 재사용 가능한 컴포넌트 (버튼, 모달 등)
            story/          # 스토리 관련 UI
            fandom/         # 팬덤 페이지 UI
        pages/              # 페이지 단위 구성
            LoginPage.tsx
            StorySettingPage.tsx
            StoryPage.tsx
            StoryChapterPage.tsx
            FandomPage.tsx
            UserProfilePage.tsx
        store/              # 상태관리 (Redux/Zustand/Recoil)
        utils/              # 프론트 유틸
```